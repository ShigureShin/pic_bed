#computer 

---
# 指令周期

**指令周期**：CPU 从主存中每取出并执行一条指令所需的全部时间
- 若干个**机器周期**或**CPU 周期**

![](../img/Pasted%20image%2020231215102306.png)

这里将译码即分析指令的过程，并入了取指周期中。由于取指令需要经过访存，时间开销较大，而（IR）分析指令的过程很快

机器周期又包含若干**时钟周期**（节拍、T 周期、CPU 时钟周期），CPU 操作的最基本单位
- 每个指令周期内的机器周期可以不等
![](../img/Pasted%20image%2020231215114017.png)
- 每个机器周期内的节拍数也可以不等
![](../img/Pasted%20image%2020231215114305.png)

# 指令周期流程

![](../img/Pasted%20image%2020231215115234.png)

CPU 如何区分目前处于哪个阶段呢？
- 可以设置四个触发器，处于哪个阶段将哪个触发器置 1
![](../img/Pasted%20image%2020231215115350.png)

四个工作周期内都存在 CPU 访存操作，但访存的目的不同：

| 周期阶段 | 访存目的   |
| -------- | ---------- |
| 取值周期 | 取指令     |
| 间址周期 | 取有效地址 |
| 执行周期 | 取操作数   |
|    终端周期      |    保存程序断点        |

# 指令周期的数据流

那么每个周期内的具体数据流动是怎么样的呢？

## 取指周期

- 目的：从存储器中取出指令

![](../img/Pasted%20image%2020231215115758.png)

具体的流程如下：
- 将当前指令地址送至存储器地址寄存器即 MAR 中
	- (PC) -> MAR
- CU 发出控制信号（读信号），经过*控制总线*传到主存
	- 1 -> R
- 在主存中访问 MAR 所保存的地址位置的数据，经过*数据总线*送入 MDR 中
	- M (MAR) -> MDR
	- 这里的 M()表示从主存中取出括号内地址位置的数据
- 再将 MDR 中的内容（*指令*）送入 IR
	- (MDR) -> IR
- CU 发出控制信号，形成下一条指令地址
	- (PC)+1 -> PC

## 间址周期

此时是间接寻址，需要找到*最终的有效地址*

![](../img/Pasted%20image%2020231215121021.png)

如果是间接寻址，经过取指周期后到达 IR 中的才是指向地址真正存储位置的地址

- 将指令真正的地址码传入 MAR
	- Ad (IR) -> MAR
	- Ad (MDR) -> MAR（也可以直接从 MDR 传入MAR）
- CU 发出控制信号，启动主存的读操作
	- 1 -> R
- 将 MAR 所指主存中的内容经过数据总线送入 MDR
	- M (MAR) -> MDR
- 将有效地址 EA 送至指令的地址码字段
	- (MDR)->Ad (IR)

## 执行周期

当从存储器中取出指令后，就可以执行指令了，即进入执行周期

执行周期的任务：
- 根据 IR 中的指令字的操作码和操作数通过 ALU 操作产生执行结果

不同指令的执行周期操作不同，所以*没有统一的数据流向*

## 中断周期

中断了当前的任务去完成其他任务，此时需要通过*堆栈*来*保存断点*，以 SP 表示栈顶地址
- 假设 SP 指向栈顶元素
- 进栈操作时先修改指针，后存入数据

![](../img/Pasted%20image%2020231215162556.png)

- CU 控制将 SP 减 1，修改后的地址送入 MAR
	- (SP)-1 -> SP, (SP) -> MAR
	- 本质：将断点存入某个存储单元，假设地址为 a，可记作：a -> MAR
- CU 发出控制信号，启动主存做写操作
	- 1 -> W
- 将断点 (PC 内容)送入 MDR
	- (PC) -> MDR
- CU 控制将中断服务程序的入口地址（由向量地址形成部件产生）送入 PC
	- 向量地址 -> PC

# 指令执行方案

按照前边的描述，一个指令周期由多个执行步骤组成，每个步骤完成指令的一部分功能，几个依次执行的步骤完成这条指令的全部功能

由于不同的指令所需要的指令周期是不同的，我们可以强行让所有指令都选用同样的执行时间来完成，即
- **单指令周期**
	- 指令之间串行执行
	- 指令周期取决于*执行时间最长*的指令的执行时间
- 但这会降低整个系统的运行速度

另一个方案，可以为多不同类型的指令选用*不同的执行步骤*来完成
- **多指令周期**：
	- 同样为串行执行
	- 选用不同个数的时钟周期来完成不同指令的执行过程
	- 电路硬件设计更复杂

除此之外，可以参考先前的存储器那部分的内容，在每一个时钟周期内启动一条指令，并尽可能让多条指令同时运行，但这些指令各自处在*不同的执行步骤*中
- **流水线方案**
	- 指令之间并行执行


