#cg 

---
- 坐标空间有哪几种？分别是什么？
- 为什么需要多个坐标空间？
- 如何设置坐标空间？

## 3.1 为什么需要多个坐标空间？

坐标空间是什么？
- 描述一个物体在该空间中相对于坐标原点的位置
多个坐标空间
- 分别描述了各自空间中各个物体相对于自身原点的位置

核心在于，选取一个参考点，其他在该空间中的任何物体的位置描述，都是以该点为基准

而*为了更方面描述纷繁复杂的物理世界中的物体，有时候需要选择不同的参考点*，例如公园中慢跑的人，为了描述人的位置，我们可以以公园的入口为参考设置坐标系，但如果要描述人在慢跑中手臂前后摆动幅度，此时继续使用公园入门为原点的坐标系显然有些过于复杂，虽然我目前无法给出适合描述该问题的准确参考点位置，但我相信另选一个以人的某个位置为基准要比选用公园坐标系更为合适

总的来说，多个坐标空间的目的，是为了更加方便地描述不同物体的（相对）空间位置

**某些位置或方向仅在特定坐标空间中是已知的**
## 3.2 一些有用的坐标空间

> 需要不同的坐标空间，因为*某些信息是有意义的或仅在特定上下文环境中可用*

### 3.2.1 世界空间

World Coordinate System
Global/Universal 坐标空间

- **世界中的“绝对”位置，“最大”的坐标系**
- 是所有其他需要设置的坐标系的“全局性”的坐标系/参考系
- 即，其他坐标系在世界中的位置，可用世界坐标来描述
- 这里的“世界”其实仍然是一个相对概念，它指代的是我们所要描述空间的最大范围，例如上边的公园慢跑，显然公园入口为参考原点的坐标系就是所需要的世界坐标，其他坐标系例如人自身的用以描述肢体相对位置的坐标系，可以描述树木的枝杈方向相较于主干的生长方向的树木坐标系，等等

### 3.2.2 对象空间

Object Space/Model Space/Body Space
- **与特定对象关联的坐标空间**

同样，公园慢跑中，人自己的坐标空间，人向左向右转，在人自己的对象空间中是有意义的，而向东向南则相较于公园这个世界坐标有意义，当被问到人现在在哪里时，显然以公园世界坐标来表达才是有效的

综上，
- 向左、向右：是一个对象空间中表达的概念
- 向东、向南：是一个世界空间中表达的概念

### 3.2.3 相机空间

Camera Space
- *与用于渲染的视点相关联*的**对象空间**

相机空间的方向概念：相机位于原点
- +x 为右侧
- +z 指前方（相机朝向的方向）
- +y 指向上（相对于相机顶部的“向上”）

注：
- OpenGL 为右手坐标系
	- -z 指向屏幕内部
	- +z 从屏幕指向观众

**注意**：相机空间（三维空间）和屏幕空间（二维空间）的差异
- 相机空间 -> 屏幕空间的映射：**投影（projection）**

### 3.2.4 直立空间

> 正确的术语是解开对主题的更好理解的钥匙

> “命令与征服”
> 在数学和计算机科学中常用的重要实践：**为经常使用的概念命名**
- 目标：避免每次调用时重复这个想法的细节（函数式编程，函数声明和函数定义的思想类似，或计算机系统的*层层抽象*），从而减少混乱，并专注于更大的问题

直立空间：Upright Space
- 始终与世界空间的轴线保持平行的“初始对象空间”
- 如图方便理解：![](img/Pasted%20image%2020240103200747.png)
- 始终跟随对象发生变换的为 Object Space
- 而和 Object Space 原点始终重合，但其轴线和 World Space 轴线平行的为 Upright Space

**为什么要使用直立空间？**
- 对象空间和直立空间之间的转换只需要旋转（rotate）
- 直立空间和世界空间之间转换则只需要平移（translation）
将这种对对象的变换操作拆解为两个步骤，更容易理解，并且变换操作起来不容易出错

- 通过平移、旋转，分别实现*世界空间到直立空间的转换*和*直立空间到对象空间的转换*
![](img/Pasted%20image%2020240103201055.png)

注：
- 这里的直立空间还不是一个标准的名称


## 3.3 基矢量和坐标空间转换

回想我们建立多个坐标空间的目的：某些方向和位置信息仅在特定坐标空间中是已知的

- 当我们需要解决在某个特定坐标空间中的问题时，就不得不去把在其他空间中已知的信息转换到特定的坐标空间中

此时就需要，**坐标空间转换（Coordinate Space Transformation）**

围绕原点的旋转是线性变换，围绕其他任何点的旋转则是仿射（Affine）变换
- 先旋转
- 再平移

对于将世界空间变换到相机空间：（移动相机等价于反向移动世界）
- 先平移：世界原点移动到相机位置
- 再旋转：相机位置即为原点，绕原点旋转简单
会更方便一些，因为可以围绕原点进行旋转

**坐标变换核心**
- 对象空间坐标的世界空间坐标
	- 模型原点移动到世界中的位置
- 世界空间坐标的相机空间坐标
	- 移动整个世界将相机放在原点


这里可以和 OpenGL 学习的内容进行联系：
- 世界空间->相机空间
	- 顶点着色器（Vertex Shader）实现

紧接着，相机空间中的顶点被转换到**裁剪空间（Clip Space）**，最后投影到**屏幕空间（Screen Space）**

**对坐标空间变换的两种思考方式**：
- **主动变换范式（Active Transformation）**
	- 用坐标空间固定视角
	- 矢量和对象随着其坐标的变化而移动
- **被动变换范式（Passive Transformation）**
	- 视角相对于被变换的对象保持固定
	- 看起来像是变换用于测量坐标的坐标空间
- 两种思考方式的参考固定对象不同，主动：视角固定在坐标空间，被动：视角固定在被移动对象

### 3.3.2 指定坐标空间

- 如何指定相对于另一个坐标空间的坐标空间？

坐标系：原点+轴
- 原点：空间位置 Position 
- 轴：空间方向 Orientation / 也可能是比例等其他信息

要制定坐标空间位置，需要*相对于父坐标空间 Parent Coordinate Space*表示
- 子空间原点在其子空间坐标系统始终为 000

### 3.3.3 基矢量

## 3.4 嵌套坐标空间

举例：绵羊的坐标空间相对于世界空间移动，绵羊的头部坐标空间相较于绵羊的空间移动，绵羊的耳朵空间相较于绵羊的头部移动

**子坐标空间嵌套（Nested）在父坐标空间**

## 3.5 针对直立空间的再解释

数据类型（`float3`）既可以用来存储一个“点”，又可以存储一个“矢量”

如果一个 `float3` 类型的数据表示对象空间中顶点的位置，想要知道它的世界空间坐标
- 对象空间->世界空间
- 该转换必定涉及到对象位置的位移

如果这个数据表示的是对象空间的一个方向矢量，其在坐标空间转换时，*不应该包含位移*
- **矢量永远不应该被平移，但点应该平移**

---

## 3.6 练习

### 3.6.1

a. 对象空间
b. 世界空间
c. 直立空间
d. 相机空间

### 3.6.2

先沿轴平移 $[-12， 0， 6]$，再绕 y 轴顺时针转 42°

### 3.6.3

矢量线性无关：存在不全为 0 的系数 $a_1, a_2,a_3,...$ 使得： $$
a_1\vec{v_1}+a_2\vec{v_2}+a_3\vec{v_3}+... = 0
$$

a. 相关
b. 无关
c. 相关
d. 相关
e. 相关
f. 无关

### 3.6.4

a. 正交
b. 不是
c. 正交
d. 正交
e. 不是

### 3.5.5

a. 不是
b. 不是
c. 是
d. 不是
e. 是
f. 是
g. 否

### 3.6.6

对象空间 $\vec{v}$ 到直立空间 $\vec{u}$：
$$
\vec{u} = v_x\vec{p}+v_y\vec{q}+v_z\vec{r}
$$

直立空间 $\vec{u}$ 到世界空间 $\vec{w}$：
$$
\vec{w}=\vec{o}+\vec{u}
$$

| 对象空间 | 直立空间 | 世界空间 |
| ---- | ---- | ---- |
| (-1, 2, 0) | (-0.866, 2, 0.5) | (0.134, 12, 3.5) |
| (1, 2, 0) | (0.866, 2, -0.5) | (1.866, 12, 2.5) |
| (0, 0, 0) | (0, 0, 0) | (1, 10, 3) |
| (1, 5, 0.5) | (1.116, 5, -0.067) | (2.116, 15, 2.933) |
| (0, 5, 10) | (5, 5, 8.66) | (1, 15, 11.66) |

| 世界空间 | 直立空间 | 对象空间 |
| ---- | ---- | ---- |
| (1, 10, 3) | (0, 0, 0) | (0, 0, 0) |
| (0, 0, 0) | (-1, -10, -3) | () |
| (2.732, 10, 2.000) | () | () |
| (2, 11, 4) | () | () |
| (1, 20, 3) | () | () |

