#computer 

- 概念、功能、目标
- 四个特征
- 发展和分类
- 运行机制
- 中断和异常
- 系统调用
- 体系结构
- 操作系统引导（Boot）
- 虚拟机
---
## 概念和定义

下面是计算机系统的层次结构：
![](img/Pasted%20image%2020231225101005.png)

操作系统的功能：
1. *系统资源的管理者*
	- *控制和管理*整个计算机系统的硬件和软件*资源*
	- *合理地组织调度*计算机的工作和资源的*分配*
2. 向上层提供方便易用的服务
	- *提供*给用户和其他软件方便的*接口和环境*
3. 最接近硬件的一层软件
	- 计算机系统中*最基本的系统软件*

一个直观的例子：windows 操作系统的任务管理器
![](img/Pasted%20image%2020231225101840.png)

## 功能和目标

### 操作系统--作为系统资源的管理者

目标：安全、高效

以用 QQ 和朋友视频聊天为例：
- Step 1：在各个文件夹中找到 QQ 安装的位置
	- 操作系统的**文件管理**
- Step 2：双击打开 QQ. exe
	- 操作系统的**存储器管理**
- Step 3：QQ 程序正常运行
	- 操作系统的**处理机管理**
- Step 4：开始和朋友视频聊天
	- 操作系统的**设备管理**

综上，操作系统的要提供的功能为：
- **处理机管理**
- **存储器管理**
- **文件管理**
- **设备管理**

### 操作系统--向上层提供方便易用的服务

原因：硬件只能理解二进制指令，交互接口对用户不友好

**封装思想**：将一些不友好的硬件功能封装成简单易用的服务，目的是使用户更方便使用计算机，且不需要关心计算机的底层实现原理（*屏蔽了底层细节*），只需要发出相应的指令即可

对于操作系统，即为将底层硬件进行了封装，而只向上层的用户和软件提供了方便易用的接口与环境

**具体提供的服务有：**
- 直接给用户使用的
	- GUI：图形化用户接口（Graphic User Interface）
		- 形象的图形界面操作，不需要记忆复杂的命令、参数
		- 例如：windows 操作系统删除文件，只需要将文件拖拽到回收站即可
	- **命令接口**（早期的操作系统没有图形化用户界面）
		- **联机命令接口**（*交互式*命令接口）
			- 以 Windows 系统示例：cmd
		- **脱机命令接口**（*批处理*命令接口）
			- 以 Windows 系统示例：. bat 文件
		- 这联机和脱机区别在于说一句做一句还是说一堆做一堆
- 给软件/程序员使用的
	- **程序接口**
		- 在程序中通过*系统调用的方式*来使用程序接口
			- 普通用户不能直接使用，只能通过程序代码*间接使用*
		- 举例：写 C 语言中的 Hello world 程序，printf 函数的底层就是用到了操作系统提供的显式相关的“系统调用（广义指令）”
		- ![](img/Pasted%20image%2020231225102657.png)

- 命令接口和程序接口统称为 “用户接口”

### 操作系统--作为最接近硬件的层次

实现*对硬件机器的拓展*：将 CPU、内存、磁盘、显示器、键盘等硬件合理地组织起来，让硬件能够相互协调从而实现更多复杂的功能

没有任何软件支持的计算机称为**裸机**，在裸机上安装操作系统，可以提供上述所给出的：提供资源管理的功能和方便用户的服务功能

通常，覆盖了软件的机器称为**扩充机器**，或**虚拟机**

## 四个特征

操作系统的四个特征：
- **并发**
- **共享**
- **虚拟**
- **异步**

并发和共享，两个最基本的特征，二者互为存在条件

### 操作系统的特征--并发

操作系统最基本的一个特性：**并发性**

两个或多个事件在*同一时间间隔*内发生
- 宏观上，同时发生
- 微观上，交替发生

要与*并行*的概念进行区分：并行是两个或多个事件在*同一时刻同时*发生

**操作系统的并发性**：计算机系统中“同时”运行着多个程序，宏观上是同时运行，而微观上是交替运行

Tips：操作系统就是伴随着“多道程序技术”而出现的，因此*操作系统和程序并发是一起诞生的*

- *单核 CPU*同一时刻只能执行*一个程序*，各个程序只能*并发*地执行
- *多核 CPU*同一时刻可以同时执行*多个程序*，多个程序可以*并行*地执行

### 操作系统的特征--共享

**共享**，即资源共享，系统中的资源可以供内存中多个并发执行的进程共同使用

具体有两种资源共享方式：
- **互斥共享方式**
	- 一个时间段该资源只允许一个进程访问
- **同时共享方式**
	- 允许一个时间段内由多个进程“同时”访问
	- 这里的同时往往是宏观上，微观上可能是交替进行访问（分时共享）

举例：
互斥共享，使用 QQ 和微信视频，摄像头只能同一时间段分配给其中一个进程
同时共享，使用 QQ 和微信发送文件，宏观上二者同时读取并发送文件即访问硬盘资源读取数据，而微观上交替访问硬盘

### 操作系统的特征--并发和共享的关系

![](img/Pasted%20image%2020231225110429.png)

### 操作系统的特征--虚拟

把一个*物理上的实体*变成*若干个逻辑上的对应物*，前者实际存在后者为用户感受到的

举例：
- 将一个程序*放到内存*并*分配 CPU* 才能执行，但有些时候例如某些游戏的大小（80 g）很明显比内存空间（16 g）要大得多，这时候就使用到了虚拟存储器技术
	- **空分复用技术**
- 另外，在同时运行多个软件时，尽管 CPU 可能是单核，但在用户看来似乎有 6 个 CPU 在同时进行服务，这就涉及到了虚拟处理器技术
	- **时分复用技术**
	- 虚拟技术中的“**时分复用技术**”：微观上处理机在各个微小时间段内交替着为各个进程服务

从这里也可以看到，并发性对于虚拟性的意义，如果没有并发性，那么就没有实现虚拟性的意义了

### 操作系统的特征--异步

多道程序环境下，允许多个程序并发执行，但由于*资源有限*，进程的执行不是一贯到底的，而是走走停停，*以不可预知的速度向前推进*

这是系统中并发执行的程序对于有限资源的使用过程中出现冲突的一种特征，即系统拥有并发性，才有可能导致异步性

## 发展与分类

- **手工操作阶段**
- **批处理阶段**
	- *单道批处理系统*
	- *多道批处理系统*（操作系统开始出现）
- **分时操作系统**
- **实时操作系统**
- 网络操作系统
- 分布式操作系统
- 个人计算机操作系统
### 手工操作阶段
- 纸带机
	- 手工装/取纸带
	- 从纸带机读/写
	- 计算
- 缺点：
	- 用户独占全机
	- *人（慢）机（快）速度矛盾导致资源利用率低*

### 批处理阶段
#### 单道批处理系统

引入*脱机输入/输出技术*（外危机+磁带），由*监督程序*（操作系统雏形）负责控制作业的输入、输出

![](img/Pasted%20image%2020231225114201.png)

![](img/Pasted%20image%2020231225114221.png)

*主要优点*：
- 一定程序上缓解了人机速度矛盾，资源利用率有所提升
*主要缺点*：
- 内存中仅能有一道程序运行
- CPU 有大量时间是在空闲等待 I/O 完成
- 资源利用率依然很低

#### 多道批处理系统

用于支持多道程序并发运行

![](img/Pasted%20image%2020231225114429.png)

### 分时操作系统

计算机以*时间片*为单位*轮流*为各个用户/作业服务，用户可通过终端与计算机进行交互

*主要优点*：
- 用户请求可以被即时响应，*解决人机交互问题*
- 允许多个用户同时使用一台计算机，并且用户之间对计算机的操作相互独立，感受不到别人的存在
*主要缺点*：
- *不能优先处理紧急任务*
- 操作系统对各个用户都是完全公平的，循环地为每个用户/作业服务一个时间片，不区分任务的紧急性
### 实时操作系统

- 硬实时系统
	- 必须绝对严格的固定时间内
- 软实时系统
	- 能接收偶尔违反时间规定

![](img/Pasted%20image%2020231225114837.png)

### 其他几种系统

![](img/Pasted%20image%2020231225114857.png)

## 运行机制

预备知识：程序是如何运行的？

本节的指令指二进制机器指令，要注意与交互式命令接口中的指令之间的区别

### 两种指令
- 特权指令
- 非特权指令

### 两种处理器状态
- 核心态
- 用户态

### 两种程序
- 内核程序
- 应用程序

## 中断和异常

### 中断的作用

CPU 上的两种程序：
- 操作系统的内核程序
- 应用程序

合适情况下，操作系统内核会把 CPU 使用权主动让给应用程序，而应用程序此时会一直在 CPU 上运行下去，除非*操作系统发出中断信号从而重新夺回 CPU 的使用权*（唯一途径）

“中断”：CPU 由用户态变为内核态，从而操作系统重新夺回 CPU 的控制权

### 中断的类型

#### 内中断（异常、例外）

与当前执行的指令*有关*，中断信号来自 *CPU 内部*

- 陷阱、陷入 trap：陷入指令引发，程序故意引发（*系统调用*）
- 故障 fault：错误条件引起，可能被内核程序修复
- 中止 abort：致命错误引起，内核程序无法修复，CPU 使用权不会还给程序，而是直接终止。如整数除 0、非法使用特权指令

#### 外中断（中断）

与当前执行的指令*无关*，中断信号来自 *CPU 外部*

- 时钟中断
-  IO/请求中断

### 中断机制的基本原理

根据不同的中断信号，使用不同的中断处理程序进行处理。

- 检查中断信号
	- 内中断：CPU 在执行指令时会检查是否有异常发生
	- 外中断：每个指令周期末尾，CPU 都会检查是否有外中断信号需要处理
- 找到相应的中断处理程序
	- 通过*中断向量表*实现

## 系统调用

![](img/Pasted%20image%2020231226093158.png)

### 什么是系统调用，有何作用？

涉及到操作系统作为用户和计算机硬件之间接口，向上提供简单易用的服务，主要包括：
- 命令接口
- 程序接口：由一组*系统调用*组成，即*系统调用是操作系统对应用程序/程序员提供的接口*

![](img/Pasted%20image%2020231226093408.png)

应用程序通过系统调用请求获得操作系统内核的服务

### 系统调用和库函数的区别

- 有的库函数是对系统调用的进一步封装
- 有的库函数没有使用系统调用

![](img/Pasted%20image%2020231226093538.png)

### 举例：为什么系统调用是必须的？

![](img/Pasted%20image%2020231226093613.png)

系统中存在各种并发的进程，而这些进程有需要并发地共享资源，并且是需要相互之间*互斥共享*该资源

**解决方案**：通过操作系统内核对共享资源统一管理，向上提供“系统调用”。进程只能通过系统调用向操作系统内核发出请求，内核再根据各个请求进行协调处理

### 什么功能需要用到系统调用？

![](img/Pasted%20image%2020231226093852.png)

Linux 系统调用

![](img/Pasted%20image%2020231226093920.png)

主要是与*共享资源*相关的操作、会*直接影响其他进程*的操作

### 系统调用的过程

- 用户态
	- 通过传参指令给 CPU 传递指令
	- 再通过*陷入指令*引发内中断，从而转入相应的中断处理程序，即*系统调用的入口程序*
- 内核态（此时 CPU 状态更新）
	- 根据寄存器参数判断用户需要何种系统调用服务
	- 调用所需的系统调用的处理程序

![](img/Pasted%20image%2020231226094254.png)

## 操作系统的体系结构（了解）

操作系统层次结构：这里是对操作系统内核进行进一步划

![](img/Pasted%20image%2020231226094726.png)

操作系统：
- 内核（最核心的功能）
- 非内核功能（如 GUI）

### 操作系统的内核（大内核、微内核）

![](img/Pasted%20image%2020231226094757.png)

![](img/Pasted%20image%2020231226094814.png)

![](img/Pasted%20image%2020231226094940.png)

### 分层结构、模块化、外核

了解体系结构的特性、各自优缺点

![](img/Pasted%20image%2020231226095142.png)

#### 分层结构

![](img/Pasted%20image%2020231226095300.png)

- 最底层为硬件，最高层为用户接口
- 每层只可以调用更低一层

#### 模块化

![](img/Pasted%20image%2020231226095520.png)

按照相互之间功能的独立性，划分为若干个独立的模块

#### 宏内核（大内核）、微内核

![](img/Pasted%20image%2020231226095744.png)

#### 外核（exokernel）

![](img/Pasted%20image%2020231226095842.png)

## 操作系统的引导

### 什么是操作系统引导？

操作系统引导（boot）：开机的时候，怎么让操作系统运行起来
### 磁盘里有哪些相关数据？
### 操作系统引导的过程

## 虚拟机

传统计算机：![](img/Pasted%20image%2020231226100748.png)

使用虚拟化技术，将一台物理机器虚拟化为多态虚拟机器（virtual machine，VM），每个虚拟机器都可以独立运行一个操作系统

同义词：虚拟机管理程序/虚拟机监控程序/Virtual Machine Monitor/Hypervisor

### 虚拟机管理程序

虚拟机管理程序分为两类：
![](img/Pasted%20image%2020231226100935.png)

### 两类虚拟机管理程序的对比

![](img/Pasted%20image%2020231226101340.png)